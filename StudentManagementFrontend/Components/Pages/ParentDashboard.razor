@page "/parent/dashboard"
@using StudentManagementFrontend.Services
@using static StudentManagementFrontend.Models.ParentDtos
@inject ParentService ParentService
@inject NavigationManager Navigation
@attribute [Authorize(Roles = "Parent")]

<PageTitle>Parent Dashboard</PageTitle>

<div class="container-fluid animate-fade-in">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="display-6 fw-bold text-primary mb-0">My Children</h1>
            <p class="text-muted">Select a child to view detailed performance.</p>
        </div>
    </div>

    @if (isLoading)
    {
        <div class="text-center py-5">
            <div class="spinner-border text-primary" role="status"></div>
            <p class="text-muted mt-2">Loading profiles...</p>
        </div>
    }
    else if (children == null || !children.Any())
    {
        <div class="alert alert-info border-0 shadow-sm rounded-4">
            <div class="d-flex align-items-center gap-3">
                <i class="bi bi-info-circle-fill fs-4"></i>
                <div>
                    <strong>No students linked.</strong>
                    <p class="mb-0">There are no student profiles linked to your account yet.</p>
                </div>
            </div>
        </div>
    }
    else
    {
        <div class="row g-4">
            @foreach (var child in children)
            {
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 shadow-sm border-0 rounded-4 card-hover" @onclick="() => NavigateToChild(child.StudentId)" style="cursor: pointer;">
                        <div class="card-body p-4">
                            <div class="d-flex align-items-center gap-3 mb-4">
                                <div class="avatar bg-primary-light text-primary rounded-circle d-flex align-items-center justify-content-center fw-bold fs-4" style="width: 64px; height: 64px;">
                                    @child.FullName.Substring(0, 1)
                                </div>
                                <div>
                                    <h4 class="fw-bold mb-1">@child.FullName</h4>
                                    <span class="badge bg-light text-muted border">@child.GradeLevel</span>
                                </div>
                            </div>
                            
                            <div class="d-flex justify-content-between align-items-center p-3 bg-light rounded-3">
                                <div>
                                    <small class="text-muted d-block uppercase-xs">Active Courses</small>
                                    <span class="fw-bold fs-5">@child.ActiveCourses</span>
                                </div>
                                <i class="bi bi-chevron-right text-muted"></i>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
</div>

<style>
    .card-hover {
        transition: transform 0.2s, box-shadow 0.2s;
    }
    .card-hover:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-lg) !important;
    }
    .uppercase-xs {
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        font-weight: 600;
    }
</style>

@code {
    private List<ChildSummaryDto>? children;
    private bool isLoading = true;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            children = await ParentService.GetChildrenAsync();
        }
        finally
        {
            isLoading = false;
        }
    }

    private void NavigateToChild(int studentId)
    {
        Navigation.NavigateTo($"/parent/child/{studentId}");
    }
}
