@using StudentManagementFrontend.Models

<div class="card h-100 shadow-sm border-0">
    <div class="card-body p-4">
        <div class="d-flex align-items-center justify-content-between mb-4">
            <div>
                <h5 class="card-title fw-bold mb-1">AI Başarı Tahmini</h5>
                <p class="text-muted small mb-0">Yapay zeka destekli performans analizi</p>
            </div>
            <div class="icon-box bg-gradient-primary text-white rounded-3 d-flex align-items-center justify-content-center" style="width: 48px; height: 48px;">
                <i class="bi bi-cpu fs-4"></i>
            </div>
        </div>

        @if (Prediction == null)
        {
            <div class="text-center py-5">
                <div class="spinner-border text-primary" role="status"></div>
                <p class="text-muted mt-2 small">Analiz yapılıyor...</p>
            </div>
        }
        else
        {
            <div class="text-center mb-4">
                <div class="position-relative d-inline-block">
                    <!-- Gauge Visualization (CSS Only) -->
                    <div class="gauge-container mb-2">
                        <div class="gauge" style="--rotation: @(Prediction.SuccessProbability * 1.8)deg">
                            <div class="gauge-bg"></div>
                            <div class="gauge-fill" style="background: @GetColor(Prediction.RiskLevel)"></div>
                        </div>
                        <div class="gauge-cover">
                            <span class="h2 fw-bold mb-0">@Prediction.SuccessProbability%</span>
                            <span class="d-block text-muted small">Başarı İhtimali</span>
                        </div>
                    </div>
                </div>
                
                <div class="badge px-3 py-2 rounded-pill @GetBadgeClass(Prediction.RiskLevel)">
                    @GetRiskLabel(Prediction.RiskLevel)
                </div>
            </div>

            <div class="recommendations">
                <h6 class="fw-bold small text-uppercase text-muted mb-3">Öneriler</h6>
                <div class="d-flex flex-column gap-2">
                    @foreach (var rec in Prediction.Recommendations)
                    {
                        <div class="d-flex align-items-start gap-2 p-3 bg-light rounded-3 border-start border-4 @GetBorderClass(Prediction.RiskLevel)">
                            <i class="bi bi-lightbulb-fill mt-1 @GetTextClass(Prediction.RiskLevel)"></i>
                            <span class="small text-dark">@rec</span>
                        </div>
                    }
                </div>
            </div>
        }
    </div>
</div>

<style>
    .bg-gradient-primary {
        background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
    }

    .gauge-container {
        width: 160px;
        height: 90px; /* Increased slightly to prevent cutoff */
        position: relative;
        overflow: hidden;
        margin: 0 auto;
    }

    .gauge {
        width: 160px;
        height: 160px;
        border-radius: 50%;
        position: relative;
        background: #e2e8f0;
        clip-path: polygon(0 0, 100% 0, 100% 50%, 0 50%); /* Start full circle but clip bottom half */
    }
    
    .gauge-fill {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border-radius: 50%;
        background: inherit; /* Fallback */
        clip-path: polygon(0 0, 100% 0, 100% 50%, 0 50%);
        transform: rotate(var(--rotation));
        transform-origin: center;
        transition: transform 1s ease-out;
        z-index: 1; /* Ensure fill is above bg */
    }

    /* Background for the gauge track */
    .gauge::before {
        content: '';
        position: absolute;
        width: 100%;
        height: 100%;
        border-radius: 50%;
        background: #e2e8f0;
        z-index: 0;
    }
    
    .gauge-cover {
        position: absolute;
        top: 20px; /* Adjusted centering */
        left: 20px;
        width: 120px;
        height: 120px;
        background: white;
        border-radius: 50%;
        z-index: 10;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start; /* Align top to fit in half circle */
        padding-top: 30px;
    }
</style>

@code {
    [Parameter]
    public PredictionResultDto? Prediction { get; set; }

    private string GetColor(string risk) => risk switch
    {
        "High" => "#ef4444",
        "Medium" => "#f59e0b",
        _ => "#10b981"
    };

    private string GetBadgeClass(string risk) => risk switch
    {
        "High" => "bg-danger bg-opacity-10 text-danger",
        "Medium" => "bg-warning bg-opacity-10 text-warning",
        _ => "bg-success bg-opacity-10 text-success"
    };
    
    private string GetBorderClass(string risk) => risk switch
    {
        "High" => "border-danger",
        "Medium" => "border-warning",
        _ => "border-success"
    };

    private string GetTextClass(string risk) => risk switch
    {
        "High" => "text-danger",
        "Medium" => "text-warning",
        _ => "text-success"
    };

    private string GetRiskLabel(string risk) => risk switch
    {
        "High" => "Risk Seviyesi: Yüksek",
        "Medium" => "Risk Seviyesi: Orta",
        _ => "Risk Seviyesi: Düşük"
    };
}
